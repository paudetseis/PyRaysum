<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example 1: Compare PyRaysum with other synthetic and real data &mdash; pyraysum 1.0.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Example 2: Reproducing Receiver Functions for Dipping and Anisotropic Subsurface Structure" href="../2/2_reproduce_Porter-2011.html" />
    <link rel="prev" title="Classes" href="../../api.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> pyraysum
            <img src="../../_static/PyRaysum_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quick Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../links.html">GitHub Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../links.html#references">References</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../init.html">Licence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../init.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../init.html#usage">Usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html#modules">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example 1: Compare PyRaysum with other synthetic and real data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#loading-earthquake-data">Loading earthquake data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-synthetic-telewavesim-data">Loading synthetic Telewavesim data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-synthetic-data-with-pyraysum">Creating synthetic data with PyRaysum</a></li>
<li class="toctree-l2"><a class="reference internal" href="#comparison-plots">Comparison plots</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comparison-with-real-data">Comparison with real data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comparison-with-synthetic-data">Comparison with synthetic data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#computing-equivalent-phases">Computing equivalent phases</a></li>
<li class="toctree-l2"><a class="reference internal" href="#conclusion">Conclusion</a></li>
<li class="toctree-l2"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2/2_reproduce_Porter-2011.html">Example 2: Reproducing Receiver Functions for Dipping and Anisotropic Subsurface Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3/3_invert_rf.html">Example 3: Invert a Receiver Function</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Jupyter Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://nbviewer.jupyter.org/github/paudetseis/PyRaysum/blob/main/pyraysum/examples/notebooks/1_make_seismograms.ipynb">Example 1: Compare PyRaysum with other synthetic and real data</a></li>
<li class="toctree-l1"><a class="reference external" href="https://nbviewer.jupyter.org/github/paudetseis/PyRaysum/blob/main/pyraysum/examples/notebooks/2_reproduce_Porter-2011.ipynb">Example 2: Reproducing Figure 2 in Porter et al. (2011)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://nbviewer.jupyter.org/github/paudetseis/PyRaysum/blob/main/pyraysum/examples/notebooks/3_invert_rf.ipynb">Example 3: Invert a receiver function</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyraysum</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Example 1: Compare PyRaysum with other synthetic and real data</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tutorials/1/1_make_seismograms.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="example-1-compare-pyraysum-with-other-synthetic-and-real-data">
<h1>Example 1: Compare PyRaysum with other synthetic and real data<a class="headerlink" href="#example-1-compare-pyraysum-with-other-synthetic-and-real-data" title="Permalink to this heading"></a></h1>
<p>In this example we are going to compare arrival times and amplitudes
from <code class="docutils literal notranslate"><span class="pre">PyRaysum</span></code> with synthetic data from <code class="docutils literal notranslate"><span class="pre">Telewavesim</span></code>
(<a class="reference external" href="https://paudetseis.github.io/Telewavesim/">https://paudetseis.github.io/Telewavesim/</a>) and a real data example from
station <code class="docutils literal notranslate"><span class="pre">HYB</span></code> in Hyderabad, India.</p>
<p>We’ll use <code class="docutils literal notranslate"><span class="pre">obspy</span></code> to download and process seismic data, <code class="docutils literal notranslate"><span class="pre">numpy</span></code> to
read the provided <code class="docutils literal notranslate"><span class="pre">telewavesim</span></code> output and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> to make a
comparison plot.</p>
<blockquote>
<div><p><strong>NOTE:</strong> To load the data included in the PyRaysum package, you
first need to install the <code class="docutils literal notranslate"><span class="pre">Examples</span></code> folder following the notes
described
<a class="reference external" href="https://paudetseis.github.io/PyRaysum/init.html#usage">here</a>, and
execute the notebook from the Examples/notebooks/ directory.</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">obspy</span>
<span class="kn">from</span> <span class="nn">obspy.clients.fdsn</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">from</span> <span class="nn">pyraysum</span> <span class="kn">import</span> <span class="n">prs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
<section id="loading-earthquake-data">
<h2>Loading earthquake data<a class="headerlink" href="#loading-earthquake-data" title="Permalink to this heading"></a></h2>
<p>The event we will be looking at is an intermediate depth, magnitude 6.3
earthquake that occurred in the Philippines in 2002. The recording comes
from station <code class="docutils literal notranslate"><span class="pre">HYB</span></code> in Hyderabad, India, which is located on a
seismically transparent (i.e., homogeneous) cratonic crust. The
earthquake arrives due east (back-azimuth equal to 90°), so that the
east component in the seismogram is in the radial direction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the `IRIS` client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s2">&quot;IRIS&quot;</span><span class="p">)</span>

<span class="c1"># Set the origin time to search catalogue</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">obspy</span><span class="o">.</span><span class="n">UTCDateTime</span><span class="p">(</span><span class="s2">&quot;2002-01-01T11:29:22&quot;</span><span class="p">)</span>

<span class="c1"># Fetch event object</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_events</span><span class="p">(</span>
    <span class="n">starttime</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span>
    <span class="n">endtime</span><span class="o">=</span><span class="n">t0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">minmagnitude</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span>
    <span class="n">maxmagnitude</span><span class="o">=</span><span class="mf">6.5</span><span class="p">,</span>
    <span class="n">mindepth</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Display event information</span>
<span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">origins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">magnitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Origin</span>
       <span class="n">resource_id</span><span class="p">:</span> <span class="n">ResourceIdentifier</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;smi:service.iris.edu/fdsnws/event/1/query?originid=3110321&quot;</span><span class="p">)</span>
              <span class="n">time</span><span class="p">:</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="mi">2002</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">720000</span><span class="p">)</span>
         <span class="n">longitude</span><span class="p">:</span> <span class="mf">125.749</span>
          <span class="n">latitude</span><span class="p">:</span> <span class="mf">6.282</span>
             <span class="n">depth</span><span class="p">:</span> <span class="mf">140100.0</span>
     <span class="n">creation_info</span><span class="p">:</span> <span class="n">CreationInfo</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="s1">&#39;ISC&#39;</span><span class="p">)</span>
<span class="n">Magnitude</span>
        <span class="n">resource_id</span><span class="p">:</span> <span class="n">ResourceIdentifier</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;smi:service.iris.edu/fdsnws/event/1/query?magnitudeid=16655792&quot;</span><span class="p">)</span>
                <span class="n">mag</span><span class="p">:</span> <span class="mf">6.3</span>
     <span class="n">magnitude_type</span><span class="p">:</span> <span class="s1">&#39;MW&#39;</span>
      <span class="n">creation_info</span><span class="p">:</span> <span class="n">CreationInfo</span><span class="p">(</span><span class="n">author</span><span class="o">=</span><span class="s1">&#39;HRVD&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The event has a very simple P waveform that arrives just before 11:38. A
few seconds later, the surface reflected pP wave arrives. Around 11:45,
the S waves arrive. They are here shown only for orientation. We will
only be interested in the short time interval between P and pP.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set start (t1) and end (t2) times of P-wave window</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="mf">60.</span> <span class="o">+</span> <span class="mf">20.</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="mf">60.</span> <span class="o">+</span> <span class="mf">45.</span>

<span class="c1"># Here we fetch and plot -1 to +10 minutes following the P-wave window start time</span>
<span class="n">hybd</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_waveforms</span><span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;HYB&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;BH?&quot;</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="mi">60</span><span class="p">,</span> <span class="n">t1</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="n">hybd</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hybd</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">hybd</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="n">Trace</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">Stream</span><span class="p">:</span>
<span class="n">G</span><span class="o">.</span><span class="n">HYB</span><span class="o">..</span><span class="n">BHZ</span> <span class="o">|</span> <span class="mi">2002</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T11</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mf">42.047000</span><span class="n">Z</span> <span class="o">-</span> <span class="mi">2002</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T11</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mf">41.997000</span><span class="n">Z</span> <span class="o">|</span> <span class="mf">20.0</span> <span class="n">Hz</span><span class="p">,</span> <span class="mi">13200</span> <span class="n">samples</span>
<span class="n">G</span><span class="o">.</span><span class="n">HYB</span><span class="o">..</span><span class="n">BHN</span> <span class="o">|</span> <span class="mi">2002</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T11</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mf">42.047000</span><span class="n">Z</span> <span class="o">-</span> <span class="mi">2002</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T11</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mf">41.997000</span><span class="n">Z</span> <span class="o">|</span> <span class="mf">20.0</span> <span class="n">Hz</span><span class="p">,</span> <span class="mi">13200</span> <span class="n">samples</span>
<span class="n">G</span><span class="o">.</span><span class="n">HYB</span><span class="o">..</span><span class="n">BHE</span> <span class="o">|</span> <span class="mi">2002</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T11</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mf">42.047000</span><span class="n">Z</span> <span class="o">-</span> <span class="mi">2002</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T11</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mf">41.997000</span><span class="n">Z</span> <span class="o">|</span> <span class="mf">20.0</span> <span class="n">Hz</span><span class="p">,</span> <span class="mi">13200</span> <span class="n">samples</span>
</pre></div>
</div>
<img alt="../../_images/output_5_1.png" src="../../_images/output_5_1.png" />
</section>
<section id="loading-synthetic-telewavesim-data">
<h2>Loading synthetic Telewavesim data<a class="headerlink" href="#loading-synthetic-telewavesim-data" title="Permalink to this heading"></a></h2>
<p>The Telewavesim data have been created with the same subsurface
structure with <code class="docutils literal notranslate"><span class="pre">Telewavesim</span></code> (Audet et al. 2019), that computes
reverberations in a stratified medium using the matrix propagator method
(Thomson et al. 1997). It was created from the same subsurface model
(Saul et al., 2000) that we will also be using to generate synthetic
data with <code class="docutils literal notranslate"><span class="pre">pyraysum</span></code>. The incident teleseismic P wave is characterized
by 90 degree back-azimuth and 0.06 s/km slowness. Note that we are here
only looking at a much shorter time interval, i.e. 35 seconds of data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load telewavesim data</span>
<span class="n">twt</span><span class="p">,</span> <span class="n">twn</span><span class="p">,</span> <span class="n">twe</span><span class="p">,</span> <span class="n">twz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;../data/telewavesim_baz090-slow006.dat&quot;</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Get time interval `dt` from data</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">twt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">twt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Store into Stream, switch Z component polarity and set header</span>
<span class="n">twsd</span> <span class="o">=</span> <span class="n">obspy</span><span class="o">.</span><span class="n">Stream</span><span class="p">()</span>
<span class="k">for</span> <span class="n">tr</span><span class="p">,</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">twz</span><span class="p">,</span> <span class="n">twn</span><span class="p">,</span> <span class="n">twe</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;E&quot;</span><span class="p">]):</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;delta&quot;</span><span class="p">:</span> <span class="n">dt</span><span class="p">,</span> <span class="s2">&quot;station&quot;</span><span class="p">:</span> <span class="s2">&quot;tws&quot;</span><span class="p">,</span> <span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="n">channel</span><span class="p">}</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">obspy</span><span class="o">.</span><span class="n">Trace</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
    <span class="n">twsd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>

<span class="c1"># Make simple plot</span>
<span class="nb">print</span><span class="p">(</span><span class="n">twsd</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">twsd</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="n">Trace</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">Stream</span><span class="p">:</span>
<span class="o">.</span><span class="n">tws</span><span class="o">..</span><span class="n">Z</span> <span class="o">|</span> <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000000</span><span class="n">Z</span> <span class="o">-</span> <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">44.990000</span><span class="n">Z</span> <span class="o">|</span> <span class="mf">100.0</span> <span class="n">Hz</span><span class="p">,</span> <span class="mi">4500</span> <span class="n">samples</span>
<span class="o">.</span><span class="n">tws</span><span class="o">..</span><span class="n">N</span> <span class="o">|</span> <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000000</span><span class="n">Z</span> <span class="o">-</span> <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">44.990000</span><span class="n">Z</span> <span class="o">|</span> <span class="mf">100.0</span> <span class="n">Hz</span><span class="p">,</span> <span class="mi">4500</span> <span class="n">samples</span>
<span class="o">.</span><span class="n">tws</span><span class="o">..</span><span class="n">E</span> <span class="o">|</span> <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000000</span><span class="n">Z</span> <span class="o">-</span> <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">44.990000</span><span class="n">Z</span> <span class="o">|</span> <span class="mf">100.0</span> <span class="n">Hz</span><span class="p">,</span> <span class="mi">4500</span> <span class="n">samples</span>
</pre></div>
</div>
<img alt="../../_images/output_7_1.png" src="../../_images/output_7_1.png" />
</section>
<section id="creating-synthetic-data-with-pyraysum">
<h2>Creating synthetic data with PyRaysum<a class="headerlink" href="#creating-synthetic-data-with-pyraysum" title="Permalink to this heading"></a></h2>
<p>We will be using the subsurface model of the Indian craton of Saul et.
al (2000), which suggests a 32 km thick cratonic crust with P- and
S-wave velocities of 6.55 and 3.50 km/s, repectively. In <code class="docutils literal notranslate"><span class="pre">pyraysum</span></code>,
we define:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a pyraysum model</span>
<span class="n">thickn</span> <span class="o">=</span> <span class="p">[</span><span class="mi">32000</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">rho</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2800</span><span class="p">,</span> <span class="mi">3600</span><span class="p">]</span>
<span class="n">vp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6550</span><span class="p">,</span> <span class="mi">8100</span><span class="p">]</span>
<span class="n">vs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3500</span><span class="p">,</span> <span class="mi">4650</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">thickn</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">)</span>

<span class="c1"># Plot model</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/output_9_0.png" src="../../_images/output_9_0.png" />
<p>We again use the incident P-wave geometry of the Philippines earthquake:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">baz</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">slow</span> <span class="o">=</span> <span class="mf">0.06</span>
<span class="n">geom</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">Geometry</span><span class="p">(</span><span class="n">baz</span><span class="o">=</span><span class="n">baz</span><span class="p">,</span> <span class="n">slow</span><span class="o">=</span><span class="n">slow</span><span class="p">)</span>
</pre></div>
</div>
<p>In the run control (RC) parameters, we specify that we would like to: 1)
generate data in a seismometer coordinate system (east-north-up;
<code class="docutils literal notranslate"><span class="pre">rot=0</span></code>), 2) include all free surface reflections (<code class="docutils literal notranslate"><span class="pre">mults=2</span></code>); 3)
and use a sampling rate of 100 Hz (<code class="docutils literal notranslate"><span class="pre">dt=1/100</span></code>) with 2500 samples
(<code class="docutils literal notranslate"><span class="pre">npts=2500</span></code>). This yields a 25s-long seismogram. The waveforms should
not be shifted or aligned (<code class="docutils literal notranslate"><span class="pre">align=0</span></code>). Note that the unit amplitude
points <em>toward</em> the source.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set `run` parameters</span>
<span class="n">ctrl</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">Control</span><span class="p">(</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">mults</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">npts</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span>
    <span class="n">align</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Run Raysum and get seismograms</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">)</span>

<span class="c1"># Extract first (and only) ray from the result (ray index [0])</span>
<span class="n">seis</span><span class="p">,</span> <span class="n">rfs</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">seis</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="n">Trace</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">Stream</span><span class="p">:</span>
<span class="o">...</span><span class="n">SYZ</span> <span class="o">|</span> <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000000</span><span class="n">Z</span> <span class="o">-</span> <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">24.990000</span><span class="n">Z</span> <span class="o">|</span> <span class="mf">100.0</span> <span class="n">Hz</span><span class="p">,</span> <span class="mi">2500</span> <span class="n">samples</span>
<span class="o">...</span><span class="n">SYN</span> <span class="o">|</span> <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000000</span><span class="n">Z</span> <span class="o">-</span> <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">24.990000</span><span class="n">Z</span> <span class="o">|</span> <span class="mf">100.0</span> <span class="n">Hz</span><span class="p">,</span> <span class="mi">2500</span> <span class="n">samples</span>
<span class="o">...</span><span class="n">SYE</span> <span class="o">|</span> <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000000</span><span class="n">Z</span> <span class="o">-</span> <span class="mi">1970</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">24.990000</span><span class="n">Z</span> <span class="o">|</span> <span class="mf">100.0</span> <span class="n">Hz</span><span class="p">,</span> <span class="mi">2500</span> <span class="n">samples</span>
</pre></div>
</div>
<p>These are the synthetic seismograms. Once we calculate receiver
functions, they will be strored in the second return value. Right now,
this is an empty <code class="docutils literal notranslate"><span class="pre">Stream</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">rfs</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="n">Trace</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">Stream</span><span class="p">:</span>
</pre></div>
</div>
<p>Let’s continue working with the seismograms and make a quick plot.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prsd</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">prsd</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/output_17_0.png" src="../../_images/output_17_0.png" />
<p>We will now pre-process all data equally. We will filter them, and align
and normalize them to the maximum amplitude on the vertical component of
the measured seismogram.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set frequency corners in Hz</span>
<span class="n">fmin</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">20.</span>
<span class="n">fmax</span> <span class="o">=</span> <span class="mf">1.</span>

<span class="c1"># Demean and filter all data</span>
<span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="p">[</span><span class="n">hybd</span><span class="p">,</span> <span class="n">twsd</span><span class="p">,</span> <span class="n">prsd</span><span class="p">]:</span>
    <span class="n">dat</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s2">&quot;demean&quot;</span><span class="p">)</span>
    <span class="n">dat</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;bandpass&quot;</span><span class="p">,</span> <span class="n">freqmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">freqmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span> <span class="n">zerophase</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Extract the P-wave window in real data</span>
<span class="n">hybd</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>

<span class="c1"># Index of the maximum amplitude on the vertical component of the data</span>
<span class="n">imax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">hybd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

<span class="c1"># Cycle through both synthetic data and process them equally</span>
<span class="k">for</span> <span class="n">trs</span> <span class="ow">in</span> <span class="p">[</span><span class="n">prsd</span><span class="p">,</span> <span class="n">twsd</span><span class="p">]:</span>
    <span class="n">jmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">trs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>  <span class="c1"># maximum vertical amplitude</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">hybd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">times</span><span class="p">()[</span><span class="n">imax</span><span class="p">]</span> <span class="o">-</span> <span class="n">trs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">times</span><span class="p">()[</span><span class="n">jmax</span><span class="p">]</span>  <span class="c1"># relative time shift of maximum</span>
    <span class="n">dt0</span> <span class="o">=</span> <span class="n">hybd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="o">-</span> <span class="n">trs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>  <span class="c1"># absolute time difference</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">hybd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">imax</span><span class="p">]</span> <span class="o">/</span> <span class="n">trs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">jmax</span><span class="p">]</span>  <span class="c1"># relative amplitude of vertical maximum</span>
    <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">trs</span><span class="p">:</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="o">+=</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">dt0</span>  <span class="c1"># align peaks</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="n">norm</span>  <span class="c1"># normalize</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>  <span class="c1"># cut around P-wave</span>
        <span class="k">if</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span> <span class="o">==</span> <span class="s2">&quot;prs&quot;</span><span class="p">:</span>
            <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">phase_amplitudes</span> <span class="o">*=</span> <span class="n">norm</span>
</pre></div>
</div>
</section>
<section id="comparison-plots">
<h2>Comparison plots<a class="headerlink" href="#comparison-plots" title="Permalink to this heading"></a></h2>
<p>We define a function to plot the PyRaysum data against the real
Hyderabad and the synthetic Telewavesim data. Note how the book-keeping
infrastructure of <code class="docutils literal notranslate"><span class="pre">obspy.Trace</span></code> is used to store phase names, arrival
times and amplitudes. These are used here to better interpret the
seismograms.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>

    <span class="n">lws</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># linewidths ...</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;darkgray&quot;</span><span class="p">,</span> <span class="s2">&quot;crimson&quot;</span><span class="p">]</span>  <span class="c1"># colors for data and model</span>

    <span class="c1"># Subplot with 3 rows</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Cycle through components</span>
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="n">mod</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="n">trs</span> <span class="o">=</span> <span class="p">[</span><span class="n">dat</span><span class="p">,</span> <span class="n">mod</span><span class="p">]</span>

        <span class="c1"># Cycle through data and model</span>
        <span class="k">for</span> <span class="n">tr</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">trs</span><span class="p">,</span> <span class="n">lws</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">tr</span><span class="o">.</span><span class="n">times</span><span class="p">(),</span>
                <span class="n">tr</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span>
                <span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Write phase info</span>
            <span class="k">if</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span> <span class="o">==</span> <span class="s2">&quot;prs&quot;</span><span class="p">:</span>
                <span class="n">tim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">dy</span> <span class="o">=</span> <span class="mi">300</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="c1"># Time sorted, then reverse amplitude sorted</span>
                <span class="k">for</span> <span class="n">pht</span><span class="p">,</span> <span class="n">phn</span><span class="p">,</span> <span class="n">phd</span><span class="p">,</span> <span class="n">pha</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
                    <span class="nb">zip</span><span class="p">(</span>
                        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">phase_times</span><span class="p">,</span>
                        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">phase_names</span><span class="p">,</span>
                        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">phase_descriptors</span><span class="p">,</span>
                        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">phase_amplitudes</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])),</span>
                <span class="p">):</span>
                    <span class="c1"># Plot all lables opposite of largest amplitude</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">tim</span> <span class="o">-</span> <span class="n">pht</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">pha</span> <span class="o">=</span> <span class="n">amp</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">sign</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">pha</span><span class="p">)</span>  <span class="c1"># absolute amplitudes are here meaningless due to applied filter</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pht</span><span class="p">,</span> <span class="n">sign</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">dy</span><span class="p">,</span> <span class="n">phn</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pht</span><span class="p">,</span> <span class="n">sign</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="n">dy</span> <span class="o">+</span> <span class="n">sign</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">dy</span><span class="p">,</span> <span class="n">phd</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
                    <span class="n">tim</span> <span class="o">=</span> <span class="n">pht</span>
                    <span class="n">amp</span> <span class="o">=</span> <span class="n">pha</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

    <span class="c1"># Only plot lowermost time axes</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_on</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[[</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time(s)&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
<section id="comparison-with-real-data">
<h3>Comparison with real data<a class="headerlink" href="#comparison-with-real-data" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">hybd</span><span class="p">,</span> <span class="n">prsd</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Comparison between Pyraysum and seismogram recored at G.HYB&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_23_0.png" src="../../_images/output_23_0.png" />
<p>The comparison with the real data shows that some complexity of the
P-wave train can, in this simple example, be attributed to conversions
and reflections of the seismic wave field in the cratonic crust. The
long phase descriptors consist of layer numbers and phase letters.</p>
<blockquote>
<div><p>Note: Read for example “<strong>1P0P0s0S</strong>” as: A wave that travels through
layer <strong>1</strong> as an <strong>upgoing P</strong>-wave, layer <strong>0</strong> as an <strong>upgoing
P</strong>-wave, gets reflected, travels through layer <strong>0</strong> as a
<strong>downgoing S</strong>-wave, gets again reflected and finally travels
through layer <strong>0</strong> as an <strong>upgoing S</strong>-wave”. The timing and
amplitude of such reverberations will be used in example 3 to invert
for subsurface properties instead of assuming them, as we did here.</p>
</div></blockquote>
</section>
<section id="comparison-with-synthetic-data">
<h3>Comparison with synthetic data<a class="headerlink" href="#comparison-with-synthetic-data" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">twsd</span><span class="p">,</span> <span class="n">prsd</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Comparison between PyRaysum and Telewavesim synthetics&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_26_0.png" src="../../_images/output_26_0.png" />
<p>The comparison with synthetic data from Telewavesim shows a good match
of the major phases. Note that the data need to be filtered, because raw
telewavesim data suffer from aliasing at infinite frequencies.</p>
</section>
</section>
<section id="computing-equivalent-phases">
<h2>Computing equivalent phases<a class="headerlink" href="#computing-equivalent-phases" title="Permalink to this heading"></a></h2>
<p>The amplitude of the <em>PpS</em> phase is apparently overestimated on the E
component and underestimated on the Z component. This is the case,
because the RC parameter <code class="docutils literal notranslate"><span class="pre">mults=2</span></code> only computes first-order
multiples, i.e. reflections of the direct <em>P</em> wave. Reflections from
<em>PS</em> are missing, most notably <em>PSpP</em>. To address this problem, we will
next use the <code class="docutils literal notranslate"><span class="pre">RC.set_phaselist()</span></code> method to explicitly name the phases
we wish to compute. The method implicitly sets <code class="docutils literal notranslate"><span class="pre">mults=3</span></code>. <code class="docutils literal notranslate"><span class="pre">Result</span></code>
has a dedicated method <code class="docutils literal notranslate"><span class="pre">descriptors()</span></code> to list unique phases present
in the synthetic waveforms.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">phl</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">descriptors</span><span class="p">()</span>
<span class="n">eqp</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">equivalent_phases</span><span class="p">(</span><span class="n">phl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Phases computed with mult=2:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">phl</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dynamically equivalent phases:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">eqp</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Phases</span> <span class="n">computed</span> <span class="k">with</span> <span class="n">mult</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span>
<span class="p">[</span><span class="s1">&#39;1P0P&#39;</span><span class="p">,</span> <span class="s1">&#39;1P0P0p0P&#39;</span><span class="p">,</span> <span class="s1">&#39;1P0P0p0S&#39;</span><span class="p">,</span> <span class="s1">&#39;1P0P0s0S&#39;</span><span class="p">,</span> <span class="s1">&#39;1P0S&#39;</span><span class="p">]</span>

<span class="n">Dynamically</span> <span class="n">equivalent</span> <span class="n">phases</span><span class="p">:</span>
<span class="p">[</span><span class="s1">&#39;1P0P0s0P&#39;</span><span class="p">,</span> <span class="s1">&#39;1P0S0p0P&#39;</span><span class="p">,</span> <span class="s1">&#39;1P0S0p0S&#39;</span><span class="p">,</span> <span class="s1">&#39;1P0S0s0P&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>We will now set a phaselist that includes these phases using the
<code class="docutils literal notranslate"><span class="pre">equivalent</span></code> option of <code class="docutils literal notranslate"><span class="pre">set_phaselist</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ctrl</span><span class="o">.</span><span class="n">set_phaselist</span><span class="p">(</span><span class="n">phl</span><span class="p">,</span> <span class="n">equivalent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>And run <em>PyRaysum</em> and the post processing again:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run Raysum and get seismograms</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">geom</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">)</span>

<span class="n">prsd</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">prsd</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;bandpass&quot;</span><span class="p">,</span> <span class="n">freqmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">freqmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span> <span class="n">zerophase</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">jmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">prsd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>  <span class="c1"># maximum vertical amplitude</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">hybd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">times</span><span class="p">()[</span><span class="n">imax</span><span class="p">]</span> <span class="o">-</span> <span class="n">prsd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">times</span><span class="p">()[</span><span class="n">jmax</span><span class="p">]</span>  <span class="c1"># relative time shift of maximum</span>
<span class="n">dt0</span> <span class="o">=</span> <span class="n">hybd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="o">-</span> <span class="n">prsd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span>  <span class="c1"># absolute time difference</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">hybd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">imax</span><span class="p">]</span> <span class="o">/</span> <span class="n">prsd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">jmax</span><span class="p">]</span>  <span class="c1"># relative amplitude of vertical maximum</span>
<span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">prsd</span><span class="p">:</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">starttime</span> <span class="o">+=</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">dt0</span>  <span class="c1"># align peaks</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">data</span> <span class="o">*=</span> <span class="n">norm</span>  <span class="c1"># normalize</span>
    <span class="n">tr</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>  <span class="c1"># cut around P-wave</span>
    <span class="k">if</span> <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span> <span class="o">==</span> <span class="s2">&quot;prs&quot;</span><span class="p">:</span>
        <span class="n">tr</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">phase_amplitudes</span> <span class="o">*=</span> <span class="n">norm</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">twsd</span><span class="p">,</span> <span class="n">prsd</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Comparison between PyRaysum and Telewavesim synthetics, including equivalent phases&quot;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/output_33_0.png" src="../../_images/output_33_0.png" />
<p>The amplitudes of the reflected phases are now better matched. To
explore the actual amplitude contributions of the equivalent phases, we
look them up in the metadata of the synthetic seismic trace:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Name, Time, Amplitude&quot;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:4s}</span><span class="s2">  </span><span class="si">{:&gt;4.1f}</span><span class="s2">    </span><span class="si">{:&gt;7.3f}</span><span class="s2">&quot;</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">prsd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stats</span>
<span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">phase_times</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">phase_amplitudes</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">phase_names</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Name</span><span class="p">,</span> <span class="n">Time</span><span class="p">,</span> <span class="n">Amplitude</span>
<span class="n">P</span>      <span class="mf">4.5</span>      <span class="mf">1.830</span>
<span class="n">PS</span>     <span class="mf">8.9</span>     <span class="o">-</span><span class="mf">0.065</span>
<span class="n">PpP</span>   <span class="mf">13.5</span>     <span class="o">-</span><span class="mf">0.259</span>
<span class="n">PsP</span>   <span class="mf">17.9</span>     <span class="o">-</span><span class="mf">0.153</span>
<span class="n">PpS</span>   <span class="mf">17.9</span>     <span class="o">-</span><span class="mf">0.069</span>
<span class="n">PSpP</span>  <span class="mf">17.9</span>      <span class="mf">0.020</span>
<span class="n">PSsP</span>  <span class="mf">22.4</span>     <span class="o">-</span><span class="mf">0.024</span>
<span class="n">PSpS</span>  <span class="mf">22.4</span>      <span class="mf">0.005</span>
<span class="n">PsS</span>   <span class="mf">22.4</span>      <span class="mf">0.065</span>
</pre></div>
</div>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading"></a></h2>
<p>This example demonstrated how <code class="docutils literal notranslate"><span class="pre">PyRaysum</span></code> can be used to compute the
timing and amplitude of P-wave energy converted and reflected at the
base of a cratonic crust. We compared the modelling results with a real
data example from the Indian craton and a synthetic example that has
been generated with an independent waveform simulation method.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Audet, P., Thomson, C.J., Bostock, M.G., and Eulenfeld, T. (2019).
Telewavesim: Python software for teleseismic body wave modeling.
Journal of Open Source Software, 4(44), 1818,
<a class="reference external" href="https://doi.org/10.21105/joss.01818">https://doi.org/10.21105/joss.01818</a></p></li>
<li><p>Saul, J., Kumar, M. R., &amp; Sarkar, D. (2000). Lithospheric and upper
mantle structure of the Indian Shield, from teleseismic receiver
functions. Geophysical Research Letters, 27(16), 2357-2360.
<a class="reference external" href="https://doi.org/10.1029/1999GL011128">https://doi.org/10.1029/1999GL011128</a></p></li>
<li><p>Thomson, C.J. (1997). Modelling surface waves in anisotropic
structures: I. Theory. Physics of the Earth and Planetary interiors,
103, 195-206. <a class="reference external" href="https://doi.org/10.1016/S0031-9201(97)00033-2">https://doi.org/10.1016/S0031-9201(97)00033-2</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../api.html" class="btn btn-neutral float-left" title="Classes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../2/2_reproduce_Porter-2011.html" class="btn btn-neutral float-right" title="Example 2: Reproducing Receiver Functions for Dipping and Anisotropic Subsurface Structure" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Wasja Bloch, Pascal Audet.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>